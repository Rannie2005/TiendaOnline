{% extends 'base.html' %}
{% load static %}

{% block title %}Tienda{% endblock %}

{% block content %}
<div class="container mt-4">

    <!-- 🔎 Barra de búsqueda y filtros -->
    <form method="get" class="mb-4 text-center">
        <div class="input-group w-50 mx-auto">
            <input type="text" name="q" placeholder="Buscar artículos..." value="{{ request.GET.q }}"
                class="form-control shadow-sm">
            <button type="submit" class="btn btn-dark">Buscar</button>
        </div>
        <div class="row justify-content-center mt-3">
            <div class="col-md-4">
                <select name="categoria" onchange="this.form.submit()" class="form-select shadow-sm">
                    <option value="">Todas las categorías</option>
                    {% for categoria in categorias %}
                        <option value="{{ categoria.nombre }}" {% if request.GET.categoria == categoria.nombre %}selected{% endif %}>
                            {{ categoria.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </form>

    <!-- 🛍️ Grid de artículos -->
    <div class="row row-cols-2 row-cols-md-4 g-3">  <!-- 👈 4 columnas en pantallas grandes -->
        {% for articulo in articulos %}
        <div class="col">
            <div class="card h-100 shadow-sm border-0 rounded-3 small-card">
                <div class="position-relative">
                    {% if articulo.imagen_principal %}
                        <img src="{{ articulo.imagen_principal.url }}" class="card-img-top rounded-top" alt="{{ articulo.nombre }}">
                    {% else %}
                        <img src="{% static 'default.jpg' %}" class="card-img-top rounded-top" alt="{{ articulo.nombre }}">
                    {% endif %}
                    <!-- Etiqueta flotante -->
                    <span class="badge bg-dark position-absolute top-0 end-0 m-2 shadow-sm">
                        Nuevo
                    </span>
                </div>
                <div class="card-body text-center p-2">
                    <h6 class="card-title fw-bold text-truncate">{{ articulo.nombre }}</h6>
                    <p class="h6 text-dark mb-1">
                        RD$ {{ articulo.precio_minimo }} - {{ articulo.precio_maximo }}
                    </p>
                    <a href="{% url 'detalle_articulo' articulo.id %}" class="btn btn-sm btn-dark w-100 mt-2 rounded-pill">
                        Ver detalles
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
            <p class="text-center">No se encontraron artículos.</p>
        {% endfor %}
    </div>
</div>

<style>
    /* 🔹 Reducir tamaño de las cartas */
    .small-card {
        max-width: 220px;
        margin: auto;
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    /* 🔹 Efecto hover */
    .small-card:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    .card-img-top {
        height: 180px;   /* 👈 más pequeñas las imágenes */
        object-fit: cover;
    }

    .card-title {
        font-size: 0.95rem;
    }
</style>
{% endblock %}
